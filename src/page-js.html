<script>
  let table;

  const renderStrategyOptions = (strategies) => {
    const elemSelect = document.getElementById('import-strategy');
    for (const strategy in strategies) {
      elemSelect.add(new Option(strategy, strategies[strategy]))
    }
  };

  const csvToJson = (csvData) => {
    const headers = csvData.shift();
    return csvData.map((row) => {
      let jsonRow = {};
      row.forEach((value, index) => {
          jsonRow[headers[index]] = value;
      });
      return jsonRow;
    });
  };

  const setTableData = (data) => {
    if (table) {
      table.setData(data);
    }
  };

  const onLoad = () => {
    google.script.run
      .withSuccessHandler(renderStrategyOptions)
      .withFailureHandler(onFailure)
      .getStrategyOptions();

    table = new Tabulator("#import-table", {
      autoColumns: true,
      // layout: "fitColumns",
      autoColumnsDefinitions: (definitions) => {
        definitions.forEach(definition => definition['headerSort'] = false);
        return definitions;
      }
    });
  };

  window.addEventListener("load", onLoad);
</script>
